<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <link href="style.css" rel="stylesheet">
  <script src="https://d3js.org/d3.v5.min.js"></script>
</head>

<body>

<h2>Price Catagory Domestic vs International</h2>

<svg></svg>

<p>Data acquired from <a href="https://data.sfgov.org/Transportation/Air-Traffic-Passenger-Statistics/rkru-6vcg/data">data.sfgov.org</a> on February 13, 2020.</p>

<script>

// location of data file
let csv = 'bararturocsv.csv';

// configuration of svg/plot area
let config = {
  'svg': {},
  'margin': {},
  'plot': {}
};

// config.svg.height = 450;
// config.svg.width = config.svg.height * 1.618; // golden ratio
//
// config.margin.top = 10;
// config.margin.right = 10;
// config.margin.bottom = 20;
// config.margin.left = 80;
//
// config.plot.x = config.margin.left;
// config.plot.y = config.margin.top;
// config.plot.width = config.svg.width - config.margin.left - config.margin.right;
// config.plot.height = config.svg.height - config.margin.top - config.margin.bottom;

config.svg.height = 450;
config.svg.width = config.svg.height * 1.618; // golden ratio

config.margin.top = 10;
config.margin.right = 10;
config.margin.bottom = 20;
config.margin.left = 80;

config.plot.x = config.margin.left;
config.plot.y = config.margin.top;
config.plot.width = config.svg.width - config.margin.left - config.margin.right;
config.plot.height = config.svg.height - config.margin.top - config.margin.bottom;

var margin = {top: 10, right: 10, bottom: 20, left: 80}
  , width =960
  , height = 450

d3.csv(csv, convertRow).then(drawBarChart);

let parseColumnName = d3.timeParse('%Y-%m');

function convertRow(row, index) {
  // this will be our converted output row
  let out = {};

  // this will be the values from each yyyy-mm column
  // out.values = [];

  // loop through all of the columns in our original row
  // depending on column name, perform some sort of conversion
  for (let col in row) {

    switch (col) {
      case 'Passenger Count':
        out[col] = row[col];
        break;

      case 'Year of Date':
        var d = row[col].substring(0,4) + "-" + row[col].substring(4,6);
        var date = parseColumnName(d);
        // console.log(col);

        // convert the value to float
        var value = parseFloat(row[col].substring(0,4));

        out[col] = value;

        break;
      // these should be our time series values
      default:
        // console.log("IN DEFAULT");
    }
  }

  return out;
}

// var x_scale = d3.scaleBand().range([0, config.plot.width]);
// var y_scale = d3.scaleLinear().range([config.plot.height, 0]);

var x_scale = d3.scaleBand()
    .range([0, width])

var y_scale = d3.scaleLinear()
    .range([height, 0])
var svg;

function drawBarChart(data) {
  // console.log(data);

  let passenger_count = data.map(row => row['Passenger Count']);
  // console.log(passenger_count);

  let dates = data.map(row => row['Year of Date']).filter(
    (value, index, self) => {return self.indexOf(value) === index}
  );
  // console.log(dates);

  dates = dates.sort()
  let maxPassengers = d3.max(passenger_count);
  x_scale.domain(dates);
  y_scale.domain([0,maxPassengers]);

  // get the svg to draw on
  // svg = d3.select("body").select("svg")
  //   .attr("width", config.plot.width + config.margin.left + config.margin.right)
  //   .attr("height", config.plot.height + config.margin.bottom + config.margin.top)
  //   .append("g")
  //   .attr("transform", "translate(0" + (config.margin.left - 50) + "," + config.margin.top + ")"); // start of svg


  svg = d3.select("body").select("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
      .append("g")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

  svg.append("g")
    .attr("class", "x axis")
    .attr("transform", "translate(0," + height + ")")
    // .attr("transform", "translate(0," + config.plot.height + ")")
    .call(d3.axisBottom(x_scale));

  svg.append("g")
    .attr("class", "y axis")
    .call(d3.axisLeft(y_scale).ticks(10,"f").tickFormat(d3.formatPrefix(".0", 1e5)));

  svg.selectAll(".bar")
    .data(data)
      .enter().append("rect")
        .attr("class", "bar")
        .attr("x", function(d, i) { return x_scale(d['Year of Date']) })
        .attr("y", function(d) { return y_scale(d['Passenger Count']) })
        .attr("width", x_scale.bandwidth())
        .attr("height", function(d) { return height - y_scale(d['Passenger Count']) })
}

// helper method to make translating easier
function translate(x, y) {
  return 'translate(' + x + ',' + y + ')';
}

</script>
</body>
</html>
